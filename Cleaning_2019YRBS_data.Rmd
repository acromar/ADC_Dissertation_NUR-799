# Cleaning Raw 2019 YRBSS data
# Aaron Cromar
# 09-01-2023

---
title: "Cleaning 2019 YRBS Dataset"
author: "Aaron Cromar"
date: "2023-09-01"
output:
  pdf_document: default
  html_document: default
  word_document: default
---

# The following script aims to generate a clean data set for YRBS 2019 using the

## dichotomous variables

## categorical variables

# Loading R Packages

```{r setup, include=FALSE}
library(conflicted)
library(rmarkdown)
library(tidyverse)
library(haven)
library(foreign)
library(knitr)
library(usethis)
library(tidyREDCap)
```

# Loading Raw YRBS 2019 Data

```{r}
load("data/raw2019YRBS.rda")
```

# Loading Raw YRBS 2019 Dataframe

```{r}
raw_2019YRBS_df <- tidyREDCap::drop_labels(raw2019YRBS)
```

# 13677x235

# Recoding the 2019 YRBS Binary Factors

### This function is created to recode binary factors from 1 and 2 to 0 and 1.

```{r}
RecodeBinary <- function(x) {
  x <- case_when(
    x == 1 ~ 1,
    x == 2 ~ 0,
    TRUE ~ NA
  )
}
```

## The predictors will be the dichotomous and categorical variables from the YRBS.

## The dichotomous and categorical variables present the percentage of students answering the predetermined response(s) of interest (ROI). Students answering the ROI(s)are in the numerator. The denominator is either all students or a subset of students who have indicated they participate in a selected activity or behavior.

## Students must have provided valid data to be included in any dichotomous and categorical variable calculations.

#Tidying Raw 2019 YRBS Dataframe 
```{r}
clean_2019YRBS <-
  raw_2019YRBS_df |>
  select(
    weight, stratum, psu, Q1, Q2, Q3, Q4,
    Q66, raceeth, starts_with("qn")
  ) |>
  mutate(
    Sex = case_when(
      Q2 == 2 ~ "Male",
      Q2 == 1 ~ "Female",
      TRUE ~ NA_character_
    )
  ) |>
  mutate(
    Race = case_when(
      raceeth == 1 ~ "Am Indian/Alaska Native",
      raceeth == 2 ~ "Asian",
      raceeth == 3 ~ "Black or African American",
      raceeth == 4 ~ "Native Hawaiian/Other PI",
      raceeth == 5 ~ "White",
      raceeth == 6 ~ "Hispanic/Latino",
      raceeth == 7 ~ "Multiple-Hispanic",
      raceeth == 8 ~ "Multiple-Non-Hispanic",
      TRUE ~ NA_character_
    )
  ) |>
  mutate(
    Age = case_when(
      Q1 == 1 ~ 12L,
      Q1 == 2 ~ 13L,
      Q1 == 3 ~ 14L,
      Q1 == 4 ~ 15L,
      Q1 == 5 ~ 16L,
      Q1 == 6 ~ 17L,
      Q1 == 7 ~ 18L,
      TRUE ~ NA_integer_
    )
  ) |>
  mutate(
    Grade = case_when(
      Q3 == 1 ~ "9",
      Q3 == 2 ~ "10",
      Q3 == 3 ~ "11",
      Q3 == 4 ~ "12",
      TRUE ~ NA_character_
    )
  ) |>
  mutate(
    RSA1_SchoolInjury = case_when(
      Q16 == 1 ~ "0 times",
      Q16 == 2 ~ "1 time",
      Q16 == 3 ~ "2 or 3 times",
      Q16 == 4 ~ "4 or 5 times",
      Q16 == 5 ~ "6 or 7 times",
      Q16 == 6 ~ "8 or 9 times",
      Q16 == 7 ~ "10 or 11 times",
      Q16 == 8 ~ "12 or more times",
      TRUE ~ NA_character_
    )
  ) |>
  mutate(
    RSA2_PhysicalFight = case_when(
      Q17 == 1 ~ "0 times",
      Q17 == 2 ~ "1 time",
      Q17 == 3 ~ "2 or 3 times",
      Q17 == 4 ~ "4 or 5 times",
      Q17 == 5 ~ "6 or 7 times",
      Q17 == 6 ~ "8 or 9 times",
      Q17 == 7 ~ "10 or 11 times",
      Q17 == 8 ~ "12 or more times",
      TRUE ~ NA_character_
    )
  ) |>
  mutate(
    RSA3_SchoolPhysicalFight = case_when(
      Q18 == 1 ~ "0 times",
      Q18 == 2 ~ "1 time",
      Q18 == 3 ~ "2 or 3 times",
      Q18 == 4 ~ "4 or 5 times",
      Q18 == 5 ~ "6 or 7 times",
      Q18 == 6 ~ "8 or 9 times",
      Q18 == 7 ~ "10 or 11 times",
      Q18 == 8 ~ "12 or more times",
      TRUE ~ NA_character_
    )
  ) |>
  mutate(
    RSA4_ForcedSexualIntercourse = case_when(
      Q19 == 2 ~ "Yes",
      Q19 == 1 ~ "No",
      TRUE ~ NA_character_
    )
  ) |>
  mutate(
    RSA5_SexualViolence = case_when(
      Q20 == 1 ~ "0 times",
      Q20 == 2 ~ "1 time",
      Q20 == 3 ~ "2 or 3 times",
      Q20 == 4 ~ "4 or 5 times",
      Q20 == 5 ~ "6 or more times",
      TRUE ~ NA_character_
    )
  ) |>
  mutate(
    RSA6_SexualPartnerAbuse = case_when(
      Q21 == 1 ~ "No Dating",
      Q21 == 2 ~ "0 times",
      Q21 == 3 ~ "1 time",
      Q21 == 4 ~ "2 or 3 times",
      Q21 == 5 ~ "4 or 5 times",
      Q21 == 6 ~ "6 or more times",
      TRUE ~ NA_character_
    )
  ) |>
  mutate(
    RSA7_PhysicalDatingViolence = case_when(
      Q22 == 1 ~ "No Dating",
      Q22 == 2 ~ "0 times",
      Q22 == 3 ~ "1 time",
      Q22 == 4 ~ "2 or 3 times",
      Q22 == 5 ~ "4 or 5 times",
      Q22 == 6 ~ "6 or more times",
      TRUE ~ NA_character_
    )
  ) |>
  mutate(
    RSA8_SchoolPhysicalBullying = case_when(
      Q23 == 2 ~ "Yes",
      Q23 == 1 ~ "No",
      TRUE ~ NA_character_
    )
  ) |>
  mutate(
    RSA9_CyberBullying = case_when(
      Q24 == 2 ~ "Yes",
      Q24 == 1 ~ "No",
      TRUE ~ NA_character_
    )
  ) |>
  mutate(
    DEP1_Depression = case_when(
      Q25 == 2 ~ "Yes",
      Q25 == 1 ~ "No",
      TRUE ~ NA_character_
    )
  ) |>
  mutate(
    SRB1_SuicideIdeation = case_when(
      Q26 == 2 ~ "Yes",
      Q26 == 1 ~ "No",
      TRUE ~ NA_character_
    )
  ) |>
   mutate(
    SRB2_SuicidePlanning = case_when(
      Q27 == 2 ~ "Yes",
      Q27 == 1 ~ "No",
      TRUE ~ NA_character_
    )
  ) |>
   mutate(
    SRB3_SuicideAttempts = case_when(
      Q28 == 1 ~ "0 times",
      Q28 == 2 ~ "1 time",
      Q28 == 3 ~ "2 or 3 times",
      Q28 == 4 ~ "4 or 5 times",
      Q28 == 5 ~ "6 or more times",
      TRUE ~ NA_character_
    )
  ) |>
   mutate(
    SRB4_SuicideAttempts_wHCP = case_when(
      Q29 == 1 ~ "Did not attempt",
      Q29 == 2 ~ "Yes",
      Q29 == 3 ~ "No",
      TRUE ~ NA_character_
    )
  ) |>
  mutate(
    SexOrientation = case_when(
      Q66 == 1 ~ "Heterosexual",
      Q66 == 2 ~ "Gay or Lesbian",
      Q66 == 3 ~ "Bisexual",
      Q66 == 4 ~ "Not sure",
      TRUE ~ NA_character_
    )
  ) |>
  mutate(
    MDTM1_HoursofTV = case_when(
      Q79 == 1 ~ "No TV",
      Q79 == 2 ~ "Less than 1hr per day",
      Q79 == 3 ~ "1hr per day",
      Q79 == 4 ~ "2hrs per day",
      Q79 == 5 ~ "3hrs per day",
      Q79 == 6 ~ "4hrs per day",
      Q79 == 7 ~ "5hrs or more per day",
      TRUE ~ NA_character_
    )
  ) |>
  mutate(
    MDTM2_HoursofComputer_VideoGames = case_when(
      Q80 == 1 ~ "No Computer_VideoGames",
      Q80 == 2 ~ "Less than 1hr per day",
      Q80 == 3 ~ "1hr per day",
      Q80 == 4 ~ "2hrs per day",
      Q80 == 5 ~ "3hrs per day",
      Q80 == 6 ~ "4hrs per day",
      Q80 == 7 ~ "5hrs or more per day",
      TRUE ~ NA_character_
    )
  ) |>
  mutate(across(c(Q4, QN16:QN29, QN79:QN80), RecodeBinary)) |>
  select(-c(Q1, Q2, Q3, Q66, raceeth, QN66)) |>
  select(
    weight, stratum, psu, Sex, Race, Age, Grade,
    SexOrientation, everything()
  ) |>
  rename(
    Hispanic_Latino = Q4,
    RSA10_SchoolInjury = QN16,
    RSA11_PhysicalFight = QN17,
    RSA12_SchoolPhysicalFight = QN18,
    RSA13_ForcedSexualIntercourse = QN19,
    RSA14_SexualViolence = QN20,
    RSA15_SexualPartnerAbuse = QN21,
    RSA16_PhysicalDatingViolence = QN22,
    RSA17_SchoolPhysicalBullying = QN23,
    RSA18_CyberBullying = QN24,
    DEP2_Depression = QN25,
    SRB5_SuicideIdeation = QN26,
    SRB6_SuidicePlanning = QN27,
    SRB7_SuicideAttempts = QN28,
    SRB8_SuicideAttempts_wHCP = QN29,
    MDTM3_HoursofTV = QN79,
    MDTM4_HoursofComputer_VideoGames = QN80,
  ) |>
  select(-starts_with("qn")) |>
  mutate(across(c(Hispanic_Latino, RSA10_SchoolInjury:RSA18_CyberBullying, DEP2_Depression, SRB5_SuicideIdeation:SRB8_SuicideAttempts_wHCP, MDTM3_HoursofTV:MDTM4_HoursofVideoGames), factor))

usethis::use_data(clean_2019YRBS, overwrite = TRUE)
# 13677 x 
